/*! r3vis - v0.1.0 - 2013-02-04
* http://github.com/hashd 
* Copyright (c) 2013 ; Licensed MIT */
var r3={};r3.graph=function(){this.id=r3.util.getUniqueId(),this.graphdef=undefined,this.config=$.extend(!0,{},r3.config),this.frame=undefined,this.panel=undefined,this.bg=undefined,this.labels=undefined,this.categories=undefined,this.axes={hor:{group:undefined,scale:undefined,func:undefined,axis:undefined,line:undefined,label:undefined},ver:{group:undefined,scale:undefined,func:undefined,axis:undefined,line:undefined,label:undefined}},this.$=undefined},r3.graph.prototype.init=function(e){var t=this;return t.graphdef=e,t.max(t.graphdef.stepup).position(t.config.meta.position||"#"+r3.constants.name.pos||"body").setDimensions().setFrame().setPanel().setBackground().setCaption().setMetadata().setHorAxis().setVerAxis(),this},r3.graph.prototype.setDimensions=function(){var e=this;return e.height(e.config.dimension.height).width(e.config.dimension.width).top(e.config.margin.top).bottom(e.config.margin.bottom).left(e.config.margin.left).right(e.config.margin.right),this},r3.graph.prototype.setFrame=function(e){var t=this;return t.frame===undefined&&(t.frame=d3.select(t.position()||"body").append("svg")),t.frame.attr("class",r3.constants.name.frame+"_"+t.id).attr("width",t.width()+t.left()+t.right()).attr("height",t.height()+t.top()+t.bottom()),t.$=$("."+r3.constants.name.frame+"_"+t.id),this},r3.graph.prototype.setPanel=function(e){var t=this;return t.panel===undefined&&(t.panel=t.frame.append("g")),t.panel.attr("class",e||r3.constants.name.panel).attr("transform","translate("+t.left()+","+t.top()+")"),this},r3.graph.prototype.setBackground=function(e){var t=this;return t.bg===undefined&&(t.bg=t.panel.append("rect").attr("class",r3.constants.name.background).attr("height",t.height()).attr("width",t.width())),t.bg.style("fill",e||t.config.graph.background),this},r3.graph.prototype.setCaption=function(){var e=this;return e.caption=e.panel.append("g").attr("class","r3_caption"),e.caption.append("text").attr("class","r3_captiontext").text(e.config.meta.caption).attr("y",-e.config.margin.top/2).attr("x",e.config.dimension.width/2).attr("text-anchor","middle").style("font-family",e.config.caption.fontfamily).style("font-size",e.config.caption.fontsize).style("font-weight",e.config.caption.fontweight).style("font-variant",e.config.caption.fontvariant).style("text-decoration",e.config.caption.textdecoration).on("mouseover",r3.effects.caption.mouseover(e.config)).on("mouseout",r3.effects.caption.mouseout(e.config)),this},r3.graph.prototype.setMetadata=function(){var e=this;return e.labels=r3.util.getLabelArray(e.graphdef),e.categories=r3.util.getCategoryArray(e.graphdef),this},r3.graph.prototype.setHorAxis=function(){var e=this,t=e.graphdef;return e.axes.hor.group===undefined&&(e.axes.hor.group=e.panel.append("g").attr("class",r3.constants.name.horaxis).attr("transform","translate(0,"+e.height()+")")),t.orientation==="hor"?(e.axes.hor.scale=d3.scale.linear().domain([0,e.max()]).range([0,e.width()]).nice(),e.axes.hor.func=d3.svg.axis().scale(e.axes.hor.scale).ticks(e.config.axis.ticks).tickSize(-e.width(),e.config.axis.minor,0).tickPadding(e.config.axis.padding).tickSubdivide(e.config.axis.subticks).orient("bottom")):(e.axes.hor.scale=d3.scale.ordinal().rangeRoundBands([0,e.width()],e.config.scale.ordinality),e.axes.hor.func=d3.svg.axis().scale(e.axes.hor.scale).tickPadding(e.config.axis.padding).orient("bottom")),this},r3.graph.prototype.setVerAxis=function(){var e=this,t=e.graphdef;return e.axes.ver.group===undefined&&(e.axes.ver.group=e.panel.append("g").attr("class",r3.constants.name.veraxis)),t.orientation==="ver"?(e.axes.ver.scale=d3.scale.linear().domain([e.max(),0]).range([0,e.height()]).nice(),e.axes.ver.func=d3.svg.axis().scale(e.axes.ver.scale).ticks(e.config.axis.ticks).tickSize(-e.height(),e.config.axis.minor,0).tickPadding(e.config.axis.padding).tickSubdivide(e.config.axis.subticks).orient("left")):(e.axes.ver.scale=d3.scale.ordinal().rangeRoundBands([0,e.height()],e.config.scale.ordinality),e.axes.ver.func=d3.svg.axis().scale(e.axes.ver.scale).tickPadding(e.config.axis.padding).orient("left")),this},r3.graph.prototype.drawHorAxis=function(){var e=this;return e.axes.hor.axis=e.axes.hor.group.append("g").style("font-family",e.config.axis.fontfamily).style("font-size",e.config.axis.fontsize).style("font-weight",e.config.axis.fontweight).call(e.axes.hor.func),e.axes.hor.axis.selectAll("line").style("stroke",e.config.axis.strokecolor),e.axes.hor.axis.selectAll("path").style("fill","none"),e.axes.hor.line=e.panel.append("line").attr("class",r3.constants.name.horaxis).attr("y1",e.height()).attr("y2",e.height()).attr("x1","0").attr("x2",e.width()).style("stroke",e.config.axis.strokecolor),e.axes.hor.label=e.axes.hor.group.append("text").attr("display","block").attr("class","r3_axeslabel").attr("x",e.width()/2).attr("y",e.config.margin.bottom/2).attr("text-anchor","middle").text("Horizontal Axis Label"),this},r3.graph.prototype.drawVerAxis=function(){var e=this;return e.axes.ver.axis=e.axes.ver.group.append("g").style("font-family",e.config.axis.fontfamily).style("font-size",e.config.axis.fontsize).style("font-weight",e.config.axis.fontweight).call(e.axes.ver.func),e.axes.ver.axis.selectAll("line").style("stroke",e.config.axis.strokecolor),e.axes.ver.axis.selectAll("path").style("fill","none"),e.axes.ver.line=e.panel.append("line").attr("class",r3.constants.name.veraxis).attr("y1",0).attr("y2",e.height()).style("stroke",e.config.axis.strokecolor),e.axes.ver.label=e.axes.ver.group.append("text").attr("class","r3_axeslabel").attr("x",-4*e.config.margin.left/5).attr("y",e.height()/2).style("width","1em").style("writing-mode","tb-rl").style("filter","flipv fliph").style("white-space","nowrap").style("-o-tranform","rotate(270deg)").style("-moz-tranform","rotate(270deg)").style("-webkit-tranform","rotate(270deg)").attr("text-anchor","middle").text("Vertical Axis Label"),this},r3.graph.prototype.setLegend=function(){var e=this,t=e.panel.append("g").attr("class","r3_legend").attr("transform","translate("+e.width()+","+10+")");return e.legends=t.selectAll("g").data(e.categories).enter().append("g").attr("transform",function(e,t){return"translate(10,"+10*(2*t-1)+")"}).attr("class",function(t,n){return"r3_legend_"+e.categories[n]}),e.legends.append("rect").attr("class","r3_legendsign").attr("height",e.config.legend.symbolsize).attr("width",e.config.legend.symbolsize).style("fill",function(t,n){return r3.util.getColorBand(e.config,n)}).style("stroke","none").on("mouseover",r3.effects.legend.mouseover(e)).on("mouseout",r3.effects.legend.mouseout(e)),e.legends.append("text").attr("class","r3_legendtext").text(function(t,n){return e.categories[n]}).attr("dx",e.config.legend.textmargin).attr("dy",".71em").attr("text-anchor","start").style("font-family",e.config.legend.fontfamily).style("font-size",e.config.legend.fontsize).style("font-weight",e.config.legend.fontweight),this},r3.graph.prototype.finalize=function(){var e=this;return e.drawHorAxis().drawVerAxis().setLegend(),e.axes.hor.group.select(".r3_axeslabel").remove(),e.axes.ver.group.select(".r3_axeslabel").remove(),e},r3.graph.prototype.remove=function(){return this.frame.remove(),this},r3.graph.prototype.removeCaption=function(){return this.caption.remove(),this},r3.graph.prototype.removeLegend=function(){return this.legends[0]&&this.legends[0].parentNode.remove(),this},r3.graph.prototype.removePanel=function(){return this.panel.remove(),this},r3.graph.prototype.removeHorAxis=function(){return this.panel.selectAll("g."+r3.constants.name.horaxis+" > *").remove(),this.panel.selectAll("line."+r3.constants.name.horaxis).remove(),this},r3.graph.prototype.removeVerAxis=function(){return this.panel.selectAll("g."+r3.constants.name.veraxis+" > *").remove(),this.panel.selectAll("line."+r3.constants.name.veraxis).remove(),this},r3.graph.prototype.width=function(e){return e?(this.config.dimension.width=e,this):this.config.dimension.width},r3.graph.prototype.height=function(e){return e?(this.config.dimension.height=e,this):this.config.dimension.height},r3.graph.prototype.top=function(e){return e?(this.config.margin.top=e,this):this.config.margin.top},r3.graph.prototype.bottom=function(e){return e?(this.config.margin.bottom=e,this):this.config.margin.bottom},r3.graph.prototype.left=function(e){return e?(this.config.margin.left=e,this):this.config.margin.left},r3.graph.prototype.right=function(e){return e?(this.config.margin.right=e,this):this.config.margin.right},r3.graph.prototype.position=function(e){return e?(this.config.meta.position=e,this):this.config.meta.position},r3.graph.prototype.caption=function(e){return e?(this.config.meta.caption=e,this):this.config.meta.caption},r3.graph.prototype.max=function(e){return e===!0?(this.config.graph.max=r3.util.getStepMaxValue(this.graphdef),this):e===!1?(this.config.graph.max=r3.util.getMaxValue(this.graphdef),this):e==="percent"?(this.config.graph.max=100,this):this.config.graph.max},r3.util={},r3.util.extend=function(e){function t(){}return t.prototype=e.prototype||e,new t},r3.util.getUniqueId=function(){return(new Date).getTime()},r3.util.getMaxValue=function(e){return d3.max(e.categories.map(function(t){return d3.max(e.dataset[t].map(function(e){return e.value}))}))},r3.util.getStepMaxValue=function(e){var t=e.dataset[e.categories[0]].map(function(){return 0});return e.categories.map(function(n){e.dataset[n].map(function(e,n){t[n]+=e.value})}),d3.max(t)},r3.util.getSumUpArray=function(e){var t=e.dataset[e.categories[0]].map(function(){return 0});return e.categories.map(function(n){e.dataset[n].map(function(e,n){t[n]+=e.value})}),t},r3.util.getPercentage=function(e,t){return e*100/t},r3.util.getDataArray=function(e){return e.categories.map(function(t){return e.dataset[t]})},r3.util.getTabularArray=function(e){var t=[],n,r,i,s,o=[];for(n=0,s=e.dataset[e.categories[0]].length;n<s;n+=1){o=[],o.push(e.dataset[e.categories[0]][n].name);for(r=0,i=e.categories.length;r<i;r+=1)o.push(e.dataset[e.categories[r]][n].value);t.push(o)}return t},r3.util.getLabelArray=function(e){return e.dataset[e.categories[0]].map(function(e){return e.name})},r3.util.getCategoryArray=function(e){return e.categories.map(function(e){return e})},r3.util.getCategoryData=function(e,t){return t.map(function(t){return e.dataset[t].map(function(e){return e.value})})},r3.util.transposeData=function(e){var t={},n,r,i,s,o,u,a,f=e.dataset[e.categories[0]].map(function(e){return e.name});for(n=0,i=f.length;n<i;n+=1)t[f[n]]=[];for(n=0,i=e.categories.length;n<i;n+=1){o=e.categories[n];for(r=0,s=e.dataset[o].length;r<s;r+=1)u=e.dataset[o][r].name,a=e.dataset[o][r].value,t[u].push({name:o,value:a})}e.categories=f,e.dataset=t},r3.util.getPascalCasedName=function(e){return e.substring(0,1).toUpperCase()+e.substring(1)},r3.util.getColorBand=function(e,t){var n=r3.palette[e.graph.palette].length;return r3.palette[e.graph.palette][t%n]},r3.config={graph:{palette:"Brink",background:"white",type:undefined,orientation:"Horizontal",max:0},meta:{position:"#r3_div",caption:"Usage of browsers by the years"},dimension:{width:400,height:400},margin:{top:40,bottom:90,left:100,right:100},axis:{ticks:8,subticks:1,padding:5,minor:-10,strokecolor:"#000",fontfamily:"Ubuntu",fontsize:"11",fontweight:"normal"},scale:{ordinality:.2},table:{tableclass:"r3_table",headerclass:"r3_header",bodyclass:"r3_body",footerclass:"r3_footer"},bar:{strokecolor:"none",fontfamily:"Arial",fontsize:"10",fontweight:"bold",textcolor:"black"},line:{interpolation:"linear"},area:{interpolation:"cardinal",opacity:.2},pie:{fontfamily:"Ubuntu",fontsize:"14",fontweight:"normal",fontvariant:"small-caps",fontfill:"white",strokecolor:"none",strokewidth:2},donut:{fontfamily:"ubuntu",fontsize:"14",fontweight:"normal",fontvariant:"small-caps",fontfill:"white",factor:.4,strokecolor:"none",strokewidth:2},caption:{fontfamily:"Cambria",fontsize:"14",fontweight:"bold",fontvariant:"small-caps",textdecoration:"underline",hovercolor:"dimgrey"},legend:{fontfamily:"Ubuntu",fontsize:"12",fontweight:"normal",textmargin:15,symbolsize:10},effects:{hovercolor:"red",strokecolor:"none",textcolor:"black",duration:800,hover:400}},r3.constants={},r3.constants.defaultHorGraphdef={pos:"#r3_div",orientation:"hor",stepup:!1,charttype:undefined,categories:["IE","Chrome","Firefox","Opera","Safari"],dataset:{IE:[{name:"2001",value:60},{name:"2002",value:70},{name:"2003",value:80},{name:"2004",value:90},{name:"2005",value:20}],Chrome:[{name:"2001",value:10},{name:"2002",value:30},{name:"2003",value:50},{name:"2004",value:90},{name:"2005",value:70}],Firefox:[{name:"2001",value:50},{name:"2002",value:150},{name:"2003",value:20},{name:"2004",value:80},{name:"2005",value:40}],Opera:[{name:"2001",value:90},{name:"2002",value:60},{name:"2003",value:30},{name:"2004",value:10},{name:"2005",value:70}],Safari:[{name:"2001",value:30},{name:"2002",value:10},{name:"2003",value:60},{name:"2004",value:90},{name:"2005",value:40}]}},r3.constants.defaultVerGraphdef={pos:"#r3_div",orientation:"ver",stepup:!1,charttype:undefined,categories:["IE","Chrome","Firefox","Opera","Safari"],dataset:{IE:[{name:"2001",value:60},{name:"2002",value:70},{name:"2003",value:80},{name:"2004",value:90},{name:"2005",value:20}],Chrome:[{name:"2001",value:10},{name:"2002",value:30},{name:"2003",value:50},{name:"2004",value:90},{name:"2005",value:70}],Firefox:[{name:"2001",value:50},{name:"2002",value:150},{name:"2003",value:20},{name:"2004",value:80},{name:"2005",value:40}],Opera:[{name:"2001",value:90},{name:"2002",value:60},{name:"2003",value:30},{name:"2004",value:10},{name:"2005",value:70}],Safari:[{name:"2001",value:30},{name:"2002",value:10},{name:"2003",value:60},{name:"2004",value:90},{name:"2005",value:40}]}},r3.constants.name={pos:"r3_div",frame:"r3_frame",panel:"r3_panel",background:"r3_bg",horaxis:"r3_horaxis",veraxis:"r3_veraxis"},r3.effects={},r3.effects.bar={},r3.effects.bar.mouseover=function(e,t){var n=function(){d3.select(this.parentNode.parentNode).selectAll("rect").transition().duration(e.effects.hover).style("fill",e.effects.hovercolor).style("stroke",e.effects.strokecolor),d3.select(this.parentNode.parentNode).selectAll("text").transition().duration(e.effects.hover).style("fill",e.effects.textcolor).style("opacity",1)};return t&&t.on("mouseover",n),n},r3.effects.bar.mouseout=function(e,t){return function(){d3.select(this.parentNode.parentNode).selectAll("rect").transition().duration(e.effects.hover).style("fill",t).style("stroke","none"),d3.select(this.parentNode.parentNode).selectAll("text").transition().duration(e.effects.hover).style("fill","none")}},r3.effects.area={},r3.effects.area.mouseover=function(e){return function(){d3.select(this).transition().duration(e.effects.hover).style("fill",e.effects.hovercolor)}},r3.effects.area.mouseout=function(e){return function(t,n){d3.select(this).transition().duration(e.effects.hover).style("fill",r3.util.getColorBand(e,n))}},r3.effects.line={},r3.effects.line.mouseover=function(e){return function(){d3.select(this.parentNode).selectAll("circle").transition().duration(e.effects.hover).style("fill",e.effects.hovercolor).style("fill-opacity",1).style("stroke",e.effects.hovercolor),d3.select(this.parentNode).select("path").transition().duration(e.effects.hover).style("stroke",e.effects.hovercolor),d3.select(this.parentNode).selectAll("text").transition().duration(e.effects.hover).style("fill",e.effects.textcolor)}},r3.effects.line.mouseout=function(e,t){return function(){d3.select(this.parentNode).selectAll("circle").transition().duration(e.effects.hover).style("fill",t).style("fill-opacity",.6).style("stroke",t),d3.select(this.parentNode).select("path").transition().duration(e.effects.hover).style("stroke",t),d3.select(this.parentNode).selectAll("text").transition().duration(e.effects.hover).style("fill","none")}},r3.effects.caption={},r3.effects.caption.mouseover=function(e){return function(){d3.select(this.parentNode.parentNode).select("."+r3.constants.name.background).transition().duration(e.effects.duration).style("fill",e.caption.hovercolor)}},r3.effects.caption.mouseout=function(e){return function(){d3.select(this.parentNode.parentNode).select("."+r3.constants.name.background).transition().duration(e.effects.duration).style("fill",e.graph.background)}},r3.effects.donut={},r3.effects.donut.mouseover=function(e,t,n,r){return function(r){var i={x:t.centroid(r)[0]/5,y:t.centroid(r)[1]/5};d3.select(this.parentNode).transition().duration(n.effects.duration).attr("transform","translate("+(e.x+i.x)+","+(e.y+i.y)+")")}},r3.effects.donut.mouseout=function(e,t){return function(){d3.select(this.parentNode).transition().duration(t.effects.duration).attr("transform","translate("+e.x+","+e.y+")")}},r3.effects.pie={},r3.effects.pie.mouseover=function(e,t,n,r){return function(r){var i={x:t.centroid(r)[0]/5,y:t.centroid(r)[1]/5};d3.select(this.parentNode).transition().duration(n.effects.duration).attr("transform","translate("+(e.x+i.x)+","+(e.y+i.y)+")")}},r3.effects.pie.mouseout=function(e,t){return function(){d3.select(this.parentNode).transition().duration(t.effects.duration).attr("transform","translate("+e.x+","+e.y+")")}},r3.effects.legend={},r3.effects.legend.mouseover=function(e){return function(t,n){e.$.find("."+e.id+"_"+e.categories[n]+":first").trigger("mouseover")}},r3.effects.legend.mouseout=function(e){return function(t,n){e.$.find("."+e.id+"_"+e.categories[n]+":first").trigger("mouseout")}},r3.palette={Plain:["#1F77B4"],Simple:["#d42f3c","#85b1e6","#FD6D16","#dfe617"],RGB:["#bb2211","#2222bb","#22aa22","#9999aa","#223322"],Olive:["#B4AF91","#787746","#40411E","#32331D"],"Soil and Sky":["#928174","#AA9788","#BDE4E9","#A8E1E9","#90D1DA"],Candid:["#EADEA1","#808355","#4E493D","#3A301C","#3F7696"],Sulphide:["#949993","#615952","#343640","#A15026","#C7B091"],"New Moon":["#EEE6AB","#C5BC8E","#696758","#45484B","#36393B"],Nature:["#EEEFD8","#BECD8A","#73880A","#CCCC33","#E2EAA3"],Earth:["#862424","#D8D1B4","#B3AB8E","#F1F0E9","#353535"],Sea:["#334433","#6699aa","#88aaaa","#aacccc","#447799"],Lemon:["#eebb00","#ddaa00","#eecc00","#ffee11"],Water:["#2266bb","#3388dd","#55aaee","#bbddee","#113355"],Grass:["#00AF64","#36D729","#61D7A4","#007241"],Hash:["tomato","yellowgreen","midnightblue","lightseagreen","gold"],Soft:["#f1b2e1","#b1ddf3","#ffde89","#e3675c","#c2d985"],Brink:["#01243b","#5288d8","#9da7b2","#c5c5c5","#71c42b"],Bright:["#ef597b","#ff6d31","#73b66b","#ffcb18","#29a2c6"],Lint:["#667b99","#afbbd2","#ccd5e6","#e9eef6","#ff6637"]},r3.areagraph=function(e){var t=this;r3.graph.apply(t,[e]),e.stepup=!1,t.init(e),t.areagroups=[],t.dataset=r3.util.getDataArray(t.graphdef);var n,r,i,s,o,u=t.graphdef.dataset[t.graphdef.categories[0]];t.axes[t.graphdef.orientation==="hor"?"ver":"hor"].scale.domain(u.map(function(e){return e.name}));for(s=0,o=t.dataset.length;s<o;s+=1)r=t.panel.append("g").attr("class","area_"+s).datum(t.dataset[s]),n={path:r,linefunc:undefined,areafunc:undefined,line:undefined,area:undefined},t["draw"+r3.util.getPascalCasedName(t.graphdef.orientation)+"Area"](n,s),t.areagroups.push(n);t.finalize()},r3.areagraph.prototype=r3.util.extend(r3.graph),r3.areagraph.prototype.drawHorArea=function(e,t){var n=this,r=r3.util.getColorBand(n.config,t);n.axes.ver.scale.rangePoints([0,n.height()]),e.linefunc=d3.svg.line().x(function(e){return n.axes.hor.scale(e.value)}).y(function(e){return n.axes.ver.scale(e.name)+n.axes.ver.scale.rangeBand()/2}).interpolate(n.config.area.interpolation),e.areafunc=d3.svg.area().x0(n.axes.hor.scale(0)).x1(e.linefunc.x()).y(e.linefunc.y()).interpolate(n.config.area.interpolation),e.area=e.path.append("svg:path").attr("class","areapath_"+t).attr("d",e.areafunc).style("opacity",n.config.area.opacity).style("-moz-opacity",n.config.area.opacity).style("fill",r),e.line=e.path.append("svg:path").attr("class","linepath_"+t).attr("d",e.linefunc).style("stroke","white").style("fill","none"),e.path.selectAll(".dot").data(n.dataset[t]).enter().append("circle").attr("class","dot").attr("cx",e.linefunc.x()).attr("cy",e.linefunc.y()).attr("r",3.5).style("fill","white")},r3.areagraph.prototype.drawVerArea=function(e,t){var n=this,r=r3.util.getColorBand(n.config,t);n.axes.hor.scale.rangePoints([0,n.width()]),e.linefunc=d3.svg.line().x(function(e){return n.axes.hor.scale(e.name)+n.axes.hor.scale.rangeBand()/2}).y(function(e){return n.axes.ver.scale(e.value)}).interpolate(n.config.area.interpolation),e.areafunc=d3.svg.area().x(e.linefunc.x()).y0(e.linefunc.y()).y1(n.axes.ver.scale(0)).interpolate(n.config.area.interpolation),e.area=e.path.append("svg:path").attr("class","areapath_"+t).attr("d",e.areafunc).style("opacity",n.config.area.opacity).style("-moz-opacity",n.config.area.opacity).style("fill",r),e.line=e.path.append("svg:path").attr("class","linepath_"+t).attr("d",e.linefunc).style("stroke","white").style("fill","none"),e.path.selectAll(".dot").data(n.dataset[t]).enter().append("circle").attr("class","dot").attr("cx",e.linefunc.x()).attr("cy",e.linefunc.y()).attr("r",3.5).style("fill","white")},r3.bargraph=function(e){var t=this;r3.graph.call(t),t.init(e),t.bargroups={};var n,r;t.axes[t.graphdef.orientation==="hor"?"ver":"hor"].scale.domain(t.labels);for(n=0,r=t.categories.length;n<r;n+=1)t.bargroups[t.categories[n]]=t.panel.append("g").attr("class","r3_bargroup "+t.categories[n]),t["draw"+t.graphdef.orientation+"Bars"](n,r);t.finalize()},r3.bargraph.prototype=r3.util.extend(r3.graph),r3.bargraph.prototype.drawhorBars=function(e,t){var n=this,r=r3.util.getColorBand(this.config,e);bars=n.bargroups[n.categories[e]].selectAll("g").data(n.graphdef.dataset[n.categories[e]]).enter().append("g").attr("class","bar_"+n.categories[e]),bars.append("rect").attr("class",n.id+"_"+n.categories[e]).attr("height",n.axes.ver.scale.rangeBand()/t).attr("x",0).attr("y",function(e){return n.axes.ver.scale(e.name)}).style("stroke",n.config.bar.strokecolor).style("fill",r).on("mouseover",r3.effects.bar.mouseover(n.config)).on("mouseout",r3.effects.bar.mouseout(n.config,r)).transition().duration(n.config.effects.duration).delay(function(e,t){return t*n.config.effects.duration}).attr("width",function(e){return n.axes.hor.scale(e.value)}),bars.append("text").attr("y",function(e){return n.axes.ver.scale(e.name)+n.axes.ver.scale.rangeBand()/t/2}).attr("dx",4).attr("dy",".35em").attr("text-anchor","start").style("fill","none").style("font-family",n.config.bar.fontfamily).style("font-size",n.config.bar.fontsize).style("font-weight",n.config.bar.fontweight).text(function(e){return String(e.value)}).transition().duration(n.config.effects.duration).delay(function(e,t){return t*n.config.effects.duration}).attr("x",function(e){return n.axes.hor.scale(e.value)}),bars.append("svg:title").text(function(t,r){return n.categories[e]+" ["+n.labels[r]+"] : "+t.value}),n.bargroups[n.categories[e]].attr("transform","translate(0,"+e*n.axes.ver.scale.rangeBand()/t+")")},r3.bargraph.prototype.drawverBars=function(e,t){var n=this,r=r3.util.getColorBand(this.config,e);bars=n.bargroups[n.categories[e]].selectAll("g").data(n.graphdef.dataset[n.categories[e]]).enter().append("g").attr("class","bar_"+n.categories[e]),bars.append("rect").attr("class",n.id+"_"+n.categories[e]).attr("height",0).attr("width",n.axes.hor.scale.rangeBand()/t).attr("x",function(e){return n.axes.hor.scale(e.name)}).attr("y",0).style("stroke",n.config.bar.strokecolor).style("fill",r).on("mouseover",r3.effects.bar.mouseover(n.config)).on("mouseout",r3.effects.bar.mouseout(n.config,r)).transition().duration(n.config.effects.duration).delay(e*n.config.effects.duration).attr("height",function(e){return n.height()-n.axes.ver.scale(e.value)}),bars.append("text").attr("transform","scale(1,-1)").attr("x",function(e){return n.axes.hor.scale(e.name)+n.axes.hor.scale.rangeBand()/t/2}).attr("y",-10).attr("dx",0).attr("dy",".35em").attr("text-anchor","middle").style("fill","none").style("font-family",n.config.bar.fontfamily).style("font-size",n.config.bar.fontsize).style("font-weight",n.config.bar.fontweight).text(function(e){return String(e.value)}).transition().duration(n.config.effects.duration).delay(e*n.config.effects.duration).attr("y",function(e){return-(n.height()-n.axes.ver.scale(e.value))-10}),bars.append("svg:title").text(function(t,r){return n.categories[e]+" ["+n.labels[r]+"] : "+t.value}),n.bargroups[n.categories[e]].attr("transform","translate("+e*n.axes.hor.scale.rangeBand()/t+","+n.height()+") scale(1,-1)")},r3.donutgraph=function(e){var t=this;r3.graph.apply(t),t.init(e),t.radius=Math.min(t.height(),t.width())*2/5,t.center={x:t.width()/2,y:t.height()/2},t.category=e.categories[0];var n=r3.util.getCategoryData(t.graphdef,[t.category]),r=d3.svg.arc().innerRadius(t.radius*t.config.donut.factor).outerRadius(t.radius),i=d3.layout.pie();t.panel.data(n),t.arcs=t.panel.selectAll("g.arc").data(i).enter().append("g").attr("class","r_arc_"+t.category).attr("transform","translate("+t.center.x+","+t.center.y+")"),t.arcs.append("path").attr("d",r).style("fill",function(e,n){return r3.util.getColorBand(t.config,n)}).style("stroke",t.config.donut.strokecolor).style("stroke-width",t.config.donut.strokewidth).on("mouseover",r3.effects.donut.mouseover(t.center,r,t.config)).on("mouseout",r3.effects.donut.mouseout(t.center,t.config)),t.arcs.append("text").attr("transform",function(e){return"translate("+r.centroid(e)+")"}).attr("dy",".35em").attr("text-anchor","middle").style("fill",t.config.donut.fontfill).style("font-family",t.config.donut.fontfamily).style("font-size",t.config.donut.fontsize).style("font-weight",t.config.donut.fontweight).style("font-variant",t.config.donut.fontvariant).text(function(e){return String(e.value)}),t.arcs.append("svg:title").text(function(e,n){return t.labels[n]+" : "+e.value})},r3.donutgraph.prototype=r3.util.extend(r3.graph),r3.linegraph=function(e){var t=this;r3.graph.apply(t),e.stepup=!1,t.init(e),t.linegroups={},t.dataset=r3.util.getDataArray(t.graphdef);var n,r,i,s,o,u,a=t.labels;t.axes[t.graphdef.orientation==="hor"?"ver":"hor"].scale.domain(a);for(s=0,o=t.categories.length;s<o;s+=1)u=r3.util.getColorBand(t.config,s),r=t.panel.append("g").attr("class","line_"+t.categories[s]).datum(t.dataset[s]),n={path:r,func:undefined},t["draw"+r3.util.getPascalCasedName(t.graphdef.orientation)+"Lines"](n,s,u),t.linegroups[t.categories[s]]=n;t.finalize()},r3.linegraph.prototype=r3.util.extend(r3.graph),r3.linegraph.prototype.drawHorLines=function(e,t,n){var r=this,i=r.axes,s=r.config;e.func=d3.svg.line().x(function(e){return i.hor.scale(e.value)}).y(function(e){return i.ver.scale(e.name)+i.ver.scale.rangeBand()/2}).interpolate(r3.config.line.interpolation),e.path.append("path").attr("class","linepath_"+r.categories[t]).attr("d",e.func).style("fill","none").style("stroke",n).style("stroke-width",1.5).style("stroke-opacity",.01).on("mouseover",r3.effects.line.mouseover(s)).on("mouseout",r3.effects.line.mouseout(s,n)).transition().duration(3*r.config.effects.duration).delay(2*t*r.config.effects.duration).style("stroke-opacity",1),e.path.selectAll("circle").data(r.dataset[t]).enter().append("circle").attr("class","dot_"+r.categories[t]).attr("cx",e.func.x()).attr("cy",e.func.y()).attr("r",3.5).style("fill",n).style("fill-opacity",.6).style("stroke",n).on("mouseover",r3.effects.line.mouseover(s)).on("mouseout",r3.effects.line.mouseout(s,n)).append("svg:title").text(function(e,n){return r.categories[t]+" ["+r.labels[n]+"]: "+e.value}),e.path.selectAll("text").data(r.dataset[t]).enter().append("text").attr("x",function(e){return i.hor.scale(e.value)}).attr("y",function(e){return i.ver.scale(e.name)+i.ver.scale.rangeBand()/2}).attr("dx",10).attr("dy",".35em").attr("text-anchor","start").style("fill","none").style("font-family",r.config.bar.fontfamily).style("font-size",r.config.bar.fontsize).style("font-weight",r.config.bar.fontweight).text(function(e){return String(e.value)})},r3.linegraph.prototype.drawVerLines=function(e,t,n){var r=this,i=r.axes,s=r.height(),o=r.config;e.func=d3.svg.line().x(function(e){return i.hor.scale(e.name)+i.hor.scale.rangeBand()/2}).y(function(e){return i.ver.scale(e.value)}).interpolate(r3.config.line.interpolation),e.path.append("path").attr("class","linepath_"+r.categories[t]).attr("d",e.func).style("fill","none").style("stroke",n).style("stroke-width",1.5).style("stroke-opacity",.01).on("mouseover",r3.effects.line.mouseover(o)).on("mouseout",r3.effects.line.mouseout(o,n)).transition().duration(r.config.effects.duration).delay(2*t*r.config.effects.duration).style("stroke-opacity",1),e.path.selectAll("circle").data(r.dataset[t]).enter().append("circle").attr("class","dot_"+r.categories[t]).attr("cx",e.func.x()).attr("cy",e.func.y()).attr("r",3.5).style("fill",n).style("fill-opacity",.2).style("stroke",n).on("mouseover",r3.effects.line.mouseover(o)).on("mouseout",r3.effects.line.mouseout(o,n)).append("svg:title").text(function(e,n){return r.categories[t]+" ["+r.labels[n]+"]: "+e.value}),e.path.selectAll("text").data(r.dataset[t]).enter().append("text").attr("x",function(e){return i.hor.scale(e.name)+i.hor.scale.rangeBand()/2}).attr("y",function(e){return i.ver.scale(e.value)-20}).attr("dx",0).attr("dy",".71em").attr("text-anchor","middle").style("fill","none").style("font-family",r.config.bar.fontfamily).style("font-size",r.config.bar.fontsize).style("font-weight",r.config.bar.fontweight).text(function(e){return String(e.value)})},r3.percent_areagraph=function(e){r3.graph.call(this,e),e.stepup="percent",this.init(e),stacklayout=d3.layout.stack().offset("zero")(this.categories.map(function(t){return e.dataset[t].map(function(e){return{x:e.name,y:+e.value}})}));var t,n,r,i=this.labels,s=this.categories;this.axes[this.graphdef.orientation==="hor"?"ver":"hor"].scale.domain(i),this.areagroup=this.panel.selectAll("g.areagroup").data(stacklayout).enter().append("g").attr("class","areagroup"),this["draw"+this.graphdef.orientation+"StackArea"](),this.finalize()},r3.percent_areagraph.prototype=r3.util.extend(r3.graph),r3.percent_areagraph.prototype.drawhorStackArea=function(){var e=this.axes,t=this.categories,n=this.config,r=r3.util.getSumUpArray(this.graphdef);e.ver.scale.rangePoints([0,this.height()]),this.areagroup.append("path").attr("class",function(e,n){return"area_"+t[n]}).style("fill",function(e,t){return r3.util.getColorBand(n,t)}).attr("d",d3.svg.area().y(function(t){return e.ver.scale(t.x)+e.ver.scale.rangeBand()/2}).x0(function(t,n){return e.hor.scale(r3.util.getPercentage(t.y0,r[n]))}).x1(function(t,n){return e.hor.scale(r3.util.getPercentage(t.y0+t.y,r[n]))}).interpolate(this.config.area.interpolation)).on("mouseover",r3.effects.area.mouseover(this.config)).on("mouseout",r3.effects.area.mouseout(this.config)),this.areagroup.append("path").attr("class",function(e,n){return"line_"+t[n]}).style("stroke","white").style("fill","none").style("stroke-width",2).attr("d",d3.svg.line().y(function(t){return e.ver.scale(t.x)+e.ver.scale.rangeBand()/2}).x(function(t,n){return e.hor.scale(r3.util.getPercentage(t.y0+t.y,r[n]))}).interpolate(this.config.area.interpolation))},r3.percent_areagraph.prototype.drawverStackArea=function(){var e=this.axes,t=this.categories,n=this.config,r=r3.util.getSumUpArray(this.graphdef);e.hor.scale.rangePoints([0,this.width()]),this.areagroup.append("path").attr("class",function(e,n){return"area_"+t[n]}).style("fill",function(e,t){return r3.util.getColorBand(n,t)}).attr("d",d3.svg.area().x(function(t){return e.hor.scale(t.x)+e.hor.scale.rangeBand()/2}).y0(function(t,n){return e.ver.scale(r3.util.getPercentage(t.y0,r[n]))}).y1(function(t,n){return e.ver.scale(r3.util.getPercentage(t.y0+t.y,r[n]))}).interpolate(this.config.area.interpolation)).on("mouseover",r3.effects.area.mouseover(this.config)).on("mouseout",r3.effects.area.mouseout(this.config)),this.areagroup.append("path").attr("class",function(e,n){return"line_"+t[n]}).style("stroke","white").style("fill","none").style("stroke-width",2).attr("d",d3.svg.line().x(function(t,n){return e.hor.scale(t.x)+e.hor.scale.rangeBand()/2}).y(function(t,n){return e.ver.scale(r3.util.getPercentage(t.y0+t.y,r[n]))}).interpolate(this.config.area.interpolation))},r3.percent_bargraph=function(e){r3.graph.call(this),e.stepup="percent",this.config.scale.ordinality=0,this.init(e),this.bargroups=[];var t,n,r,i,s,o=this.labels,u=o.map(function(e){return 0}),a=o.map(function(e){return 0});this.axes[this.graphdef.orientation==="hor"?"ver":"hor"].scale.domain(o);for(r=0,i=this.categories.length;r<i;r+=1)s=r3.util.getColorBand(this.config,r),t=this.panel.append("g").attr("class","r3_bargroup"),n=t.selectAll("g").data(this.graphdef.dataset[this.categories[r]]).enter().append("g").attr("class","percentbar_"+this.categories[r]),this["drawStack"+r3.util.getPascalCasedName(this.graphdef.orientation)+"Bars"](n,u,a,r),this.graphdef.orientation==="ver"&&t.attr("transform","translate(0,"+2*this.height()+") scale(1,-1)"),this.bargroups.push(t);this.finalize()},r3.percent_bargraph.prototype=r3.util.extend(r3.graph),r3.percent_bargraph.prototype.drawStackHorBars=function(e,t,n,r){var i=this.axes,s=r3.util.getColorBand(this.config,r),o=this.config,u=r3.util.getSumUpArray(this.graphdef);e.append("rect").attr("height",i.ver.scale.rangeBand()).attr("width",0).attr("x",function(e,n){var r=i.hor.scale(r3.util.getPercentage(t[n],u[n]));return t[n]+=e.value,r}).attr("y",function(e){return i.ver.scale(e.name)}).style("stroke","none").style("fill",s).on("mouseover",r3.effects.bar.mouseover(o)).on("mouseout",r3.effects.bar.mouseout(o,s)).transition().duration(r3.config.effects.duration).delay(r*r3.config.effects.duration).attr("width",function(e,t){return i.hor.scale(r3.util.getPercentage(e.value,u[t]))}),e.append("text").attr("y",function(e){return i.ver.scale(e.name)+i.ver.scale.rangeBand()/2}).attr("dx",0).attr("dy",".35em").attr("text-anchor","end").style("fill","none").style("font-family",this.config.bar.fontfamily).style("font-size",this.config.bar.fontsize).style("font-weight",this.config.bar.fontweight).text(function(e,n){return i.hor.scale(r3.util.getPercentage(t[n],u[n]))>15?String(Math.round(r3.util.getPercentage(e.value,u[n]))):null}).transition().duration(r3.config.effects.duration).delay(r*r3.config.effects.duration).attr("x",function(e,t){return n[t]+=e.value,i.hor.scale(r3.util.getPercentage(n[t],u[t]))-5})},r3.percent_bargraph.prototype.drawStackVerBars=function(e,t,n,r){var i=this.height(),s=this.axes,o=r3.util.getColorBand(this.config,r),u=this.config,a=r3.util.getSumUpArray(this.graphdef);e.append("rect").attr("height",0).attr("width",s.hor.scale.rangeBand()).attr("x",function(e){return s.hor.scale(e.name)}).attr("y",function(e,n){var r=s.ver.scale(r3.util.getPercentage(t[n],a[n]));return t[n]-=e.value,r}).style("stroke","none").style("fill",o).on("mouseover",r3.effects.bar.mouseover(u)).on("mouseout",r3.effects.bar.mouseout(u,o)).transition().duration(r3.config.effects.duration).delay(r*r3.config.effects.duration).attr("height",function(e,t){return i-s.ver.scale(r3.util.getPercentage(e.value,a[t]))}),e.append("text").attr("transform","scale(1,-1)").attr("x",function(e){return s.hor.scale(e.name)+s.hor.scale.rangeBand()/2}).attr("y",-i+5).attr("dy",".71em").attr("text-anchor","middle").style("fill","none").style("font-family",this.config.bar.fontfamily).style("font-size",this.config.bar.fontsize).style("font-weight",this.config.bar.fontweight).text(function(e,t){return i-s.ver.scale(r3.util.getPercentage(e.value,a[t]))>15?String(Math.round(r3.util.getPercentage(e.value,a[t]))):null}).transition().duration(r3.config.effects.duration).delay(r*r3.config.effects.duration).attr("y",function(e,t){return n[t]+=e.value,-(2*i-s.ver.scale(r3.util.getPercentage(n[t],a[t])))+5})},r3.piegraph=function(e){var t=this;r3.graph.apply(t),t.init(e),t.radius=Math.min(t.height(),t.width())*2/5,t.center={x:t.width()/2,y:t.height()/2},t.category=e.categories[0];var n=r3.util.getCategoryData(t.graphdef,[t.category]),r=d3.svg.arc().innerRadius(0).outerRadius(t.radius),i=d3.layout.pie();t.panel.data(n),t.arcs=t.panel.selectAll("g.arc").data(i).enter().append("g").attr("class","r3_arc"+t.category).attr("transform","translate("+t.center.x+","+t.center.y+")"),t.arcs.append("path").attr("d",r).style("fill",function(e,n){return r3.util.getColorBand(t.config,n)}).style("stroke",t.config.pie.strokecolor).style("stroke-width",t.config.pie.strokewidth).on("mouseover",r3.effects.pie.mouseover(t.center,r,t.config)).on("mouseout",r3.effects.pie.mouseout(t.center,t.config)),t.arcs.append("text").attr("transform",function(e){return"translate("+r.centroid(e)+")"}).attr("dy",".35em").attr("text-anchor","middle").style("fill",t.config.pie.fontfill).style("font-family",t.config.pie.fontfamily).style("font-size",t.config.pie.fontsize).style("font-weight",t.config.pie.fontweight).style("font-variant",t.config.pie.fontvariant).text(function(e){return String(e.value)}),t.arcs.append("svg:title").text(function(e,n){return t.labels[n]+" : "+e.value})},r3.piegraph.prototype=r3.util.extend(r3.graph),r3.stacked_areagraph=function(e){r3.graph.call(this,e),e.stepup=!0,this.init(e),stacklayout=d3.layout.stack().offset("zero")(this.categories.map(function(t){return e.dataset[t].map(function(e){return{x:e.name,y:+e.value}})}));var t,n,r,i=this.labels,s=this.categories;this.axes[this.graphdef.orientation==="hor"?"ver":"hor"].scale.domain(i.map(function(e){return e})),this.areagroup=this.panel.selectAll("g.areagroup").data(stacklayout).enter().append("g").attr("class","areagroup"),this["draw"+this.graphdef.orientation+"StackArea"](),this.finalize()},r3.stacked_areagraph.prototype=r3.util.extend(r3.graph),r3.stacked_areagraph.prototype.drawhorStackArea=function(){var e=this.axes,t=this.categories,n=this.config;e.ver.scale.rangePoints([0,this.height()]),this.areagroup.append("path").attr("class",function(e,n){return"area_"+t[n]}).style("fill",function(e,t){return r3.util.getColorBand(n,t)}).attr("d",d3.svg.area().y(function(t){return e.ver.scale(t.x)+e.ver.scale.rangeBand()/2}).x0(function(t){return e.hor.scale(t.y0)}).x1(function(t){return e.hor.scale(t.y0+t.y)}).interpolate(this.config.area.interpolation)).on("mouseover",r3.effects.area.mouseover(this.config)).on("mouseout",r3.effects.area.mouseout(this.config)),this.areagroup.append("path").attr("class",function(e,n){return"line_"+t[n]}).style("stroke","white").style("fill","none").style("stroke-width",2).attr("d",d3.svg.line().y(function(t){return e.ver.scale(t.x)+e.ver.scale.rangeBand()/2}).x(function(t){return e.hor.scale(t.y0+t.y)}).interpolate(this.config.area.interpolation))},r3.stacked_areagraph.prototype.drawverStackArea=function(){var e=this.axes,t=this.categories,n=this.config;e.hor.scale.rangePoints([0,this.width()]),this.areagroup.append("path").attr("class",function(e,n){return"area_"+t[n]}).style("fill",function(e,t){return r3.util.getColorBand(n,t)}).attr("d",d3.svg.area().x(function(t){return e.hor.scale(t.x)+e.hor.scale.rangeBand()/2}).y0(function(t){return e.ver.scale(t.y0)}).y1(function(t){return e.ver.scale(t.y0+t.y)}).interpolate(this.config.area.interpolation)).on("mouseover",r3.effects.area.mouseover(this.config)).on("mouseout",r3.effects.area.mouseout(this.config)),this.areagroup.append("path").attr("class",function(e,n){return"line_"+t[n]}).style("stroke","white").style("fill","none").style("stroke-width",2).attr("d",d3.svg.line().x(function(t){return e.hor.scale(t.x)+e.hor.scale.rangeBand()/2}).y(function(t){return e.ver.scale(t.y0+t.y)}).interpolate(this.config.area.interpolation))},r3.stacked_bargraph=function(e){r3.graph.call(this),e.stepup=!0,this.init(e),this.bargroups={};var t,n,r,i,s,o=this.labels,u=o.map(function(e){return 0}),a=o.map(function(e){return 0});this.axes[this.graphdef.orientation==="hor"?"ver":"hor"].scale.domain(o);for(r=0,i=this.categories.length;r<i;r+=1)this.bargroups[this.categories[r]]=this.panel.append("g").attr("class","r3_stackedbargroup_"+this.categories[r]),this["drawStack"+r3.util.getPascalCasedName(this.graphdef.orientation)+"Bars"](r,u,a);this.finalize()},r3.stacked_bargraph.prototype=r3.util.extend(r3.graph),r3.stacked_bargraph.prototype.drawStackHorBars=function(e,t,n){var r=this,i=this.axes,s=r3.util.getColorBand(this.config,e),o=this.config,u=this.bargroups[this.categories[e]];bars=u.selectAll("g").data(this.graphdef.dataset[this.categories[e]]).enter().append("g").attr("class","r3_stackedbar_"+this.categories[e]),bars.append("rect").attr("height",i.ver.scale.rangeBand()).attr("width",0).attr("x",function(e,n){var r=i.hor.scale(t[n]);return t[n]+=e.value,r}).attr("y",function(e){return i.ver.scale(e.name)}).style("stroke","none").style("fill",s).on("mouseover",r3.effects.bar.mouseover(o)).on("mouseout",r3.effects.bar.mouseout(o,s)).transition().duration(r3.config.effects.duration).delay(e*r3.config.effects.duration).attr("width",function(e){return i.hor.scale(e.value)}),bars.append("text").attr("y",function(e){return i.ver.scale(e.name)+i.ver.scale.rangeBand()/2}).attr("dx",0).attr("dy",".35em").attr("text-anchor","end").style("fill","none").style("font-family",o.bar.fontfamily).style("font-size",o.bar.fontsize).style("font-weight",o.bar.fontweight).text(function(e){return i.hor.scale(e.value)>15?String(e.value):null}).transition().duration(r3.config.effects.duration).delay(e*r3.config.effects.duration).attr("x",function(e,t){return n[t]+=e.value,i.hor.scale(n[t])-5}),bars.append("svg:title").text(function(t,n){return r.categories[e]+" ["+r.labels[n]+"] : "+t.value})},r3.stacked_bargraph.prototype.drawStackVerBars=function(e,t,n){var r=this,i=this.height(),s=this.axes,o=r3.util.getColorBand(this.config,e),u=this.config,a=this.bargroups[this.categories[e]];bars=a.selectAll("g").data(this.graphdef.dataset[this.categories[e]]).enter().append("g").attr("class","r3_stackedbar_"+this.categories[e]),bars.append("rect").attr("height",0).attr("width",s.hor.scale.rangeBand()).attr("x",function(e){return s.hor.scale(e.name)}).attr("y",function(e,n){var r=s.ver.scale(t[n]);return t[n]-=e.value,r}).style("stroke","none").style("fill",o).on("mouseover",r3.effects.bar.mouseover(u)).on("mouseout",r3.effects.bar.mouseout(u,o)).transition().duration(r3.config.effects.duration).delay(e*r3.config.effects.duration).attr("height",function(e){return i-s.ver.scale(e.value)}),bars.append("text").attr("transform","scale(1,-1)").attr("x",function(e){return s.hor.scale(e.name)+s.hor.scale.rangeBand()/2}).attr("y",-i+5).attr("dy",".71em").attr("text-anchor","middle").style("fill","none").style("font-family",u.bar.fontfamily).style("font-size",u.bar.fontsize).style("font-weight",u.bar.fontweight).text(function(e){return i-s.ver.scale(e.value)>15?String(e.value):null}).transition().duration(r3.config.effects.duration).delay(e*r3.config.effects.duration).attr("y",function(e,t){return n[t]+=e.value,-(2*i-s.ver.scale(n[t]))+5}),bars.append("svg:title").text(function(t,n){return r.categories[e]+" ["+r.labels[n]+"] : "+t.value}),a.attr("transform","translate(0,"+2*this.height()+") scale(1,-1)")},r3.stepup_bargraph=function(e){var t=this;r3.graph.apply(t),e.stepup=!0,t.init(e),this.bargroups={};var n,r,i=t.labels.map(function(e){return 0}),s=t.labels.map(function(e){return 0});t.axes[this.graphdef.orientation==="hor"?"ver":"hor"].scale.domain(this.labels);for(n=0,r=t.categories.length;n<r;n+=1)t.bargroups[t.categories[n]]=this.panel.append("g").attr("class","r3_bargroup_"+t.categories[n]),t["drawStepUp"+t.graphdef.orientation+"Bars"](n,r,i,s);t.finalize()},r3.stepup_bargraph.prototype=r3.util.extend(r3.graph),r3.stepup_bargraph.prototype.drawStepUphorBars=function(e,t,n,r){var i=this,s=r3.util.getColorBand(i.config,e),o=i.bargroups[i.categories[e]];bars=o.selectAll("g").data(i.graphdef.dataset[i.categories[e]]).enter().append("g").attr("class","stepupbar_"+i.categories[e]),bars.append("rect").attr("height",i.axes.ver.scale.rangeBand()/t).attr("width",0).attr("x",function(e,t){var r=i.axes.hor.scale(n[t]);return n[t]+=e.value,r}).attr("y",function(e){return i.axes.ver.scale(e.name)}).style("stroke","none").style("fill",s).on("mouseover",r3.effects.bar.mouseover(i.config)).on("mouseout",r3.effects.bar.mouseout(i.config,s)).transition().duration(i.config.effects.duration).delay(e*i.config.effects.duration).attr("width",function(e){return i.axes.hor.scale(e.value)}),bars.append("text").attr("y",function(e){return i.axes.ver.scale(e.name)+i.axes.ver.scale.rangeBand()/t/2}).attr("dx",4).attr("dy",".35em").attr("text-anchor","start").style("fill","none").style("font-family",i.config.bar.fontfamily).style("font-size",i.config.bar.fontsize).style("font-weight",i.config.bar.fontweight).text(function(e){return String(e.value)}).transition().duration(i.config.effects.duration).delay(e*i.config.effects.duration).attr("x",function(e,t){return r[t]+=e.value,i.axes.hor.scale(r[t])}),bars.append("svg:title").text(function(t,n){return i.categories[e]+" ["+i.labels[n]+"] : "+t.value}),o.attr("transform","translate(0,"+e*i.axes.ver.scale.rangeBand()/t+")")},r3.stepup_bargraph.prototype.drawStepUpverBars=function(e,t,n,r){var i=this,s=r3.util.getColorBand(i.config,e),o=i.bargroups[i.categories[e]];bars=o.selectAll("g").data(i.graphdef.dataset[i.categories[e]]).enter().append("g").attr("class","stepupbar_"+i.categories[e]),bars.append("rect").attr("height",0).attr("width",i.axes.hor.scale.rangeBand()/t).attr("x",function(e){return i.axes.hor.scale(e.name)}).attr("y",function(e,t){var r=i.axes.ver.scale(n[t]);return n[t]-=e.value,r}).style("stroke","none").style("fill",s).on("mouseover",r3.effects.bar.mouseover(i.config)).on("mouseout",r3.effects.bar.mouseout(i.config,s)).transition().duration(i.config.effects.duration).delay(e*i.config.effects.duration).attr("height",function(e){return i.height()-i.axes.ver.scale(e.value)}),bars.append("text").attr("transform","scale(1,-1)").attr("x",function(e){return i.axes.hor.scale(e.name)+i.axes.hor.scale.rangeBand()/t/2}).attr("y",-i.height()-10).attr("dy",".71em").attr("text-anchor","middle").style("fill","none").style("font-family",i.config.bar.fontfamily).style("font-size",i.config.bar.fontsize).style("font-weight",i.config.bar.fontweight).text(function(e){return String(e.value)}).transition().duration(i.config.effects.duration).delay(e*i.config.effects.duration).attr("y",function(e,t){return r[t]+=e.value,-(2*i.height()-i.axes.ver.scale(r[t]))-10}),bars.append("svg:title").text(function(t,n){return i.categories[e]+" ["+i.labels[n]+"] : "+t.value}),o.attr("transform","translate("+e*i.axes.hor.scale.rangeBand()/t+","+2*i.height()+") scale(1,-1)")},r3.table=function(){this.caption=undefined,this.position=undefined,this.graphdef=undefined,this.table=undefined,this.header=undefined,this.body=undefined,this.bodyrows={}},r3.table.prototype.init=function(e){this.graphdef=e,this.position=this.graphdef.pos||"#chart3rdiv"||"body",this.table=d3.select(this.position).append("table").attr("class",r3.config.table.tableclass),this.header=this.table.append("thead").attr("class",r3.config.table.headerclass),this.body=this.table.append("tbody").attr("class",r3.config.table.bodyclass)},r3.table.prototype.finalize=function(){},r3.tablegraph=function(e){r3.table.apply(this,[e]),this.init(e),this.graphdef.orientation==="hor"?this.setHorTable():this.setVerTable(),this.finalize()},r3.tablegraph.prototype=r3.util.extend(r3.table),r3.tablegraph.prototype.setHorTable=function(){var e=this.graphdef.categories,t=r3.util.getTabularArray(this.graphdef);e.unshift(""),this.header.append("tr").selectAll("td").data(e).enter().append("td").text(function(e){return e}),e.shift(),this.bodyrows=this.body.selectAll("tr").data(t).enter().append("tr"),this.bodyrows.selectAll("td").data(function(e,n){return t[n]}).enter().append("td").attr("class",function(e,t){return t===0?"chart3rtablelabel":"chart3rtabledata"}).text(function(e){return e})},r3.tablegraph.prototype.setVerTable=function(){var e=r3.util.getLabelArray(this.graphdef),t=this.graphdef.dataset;e.unshift(""),this.header.append("tr").selectAll("td").data(e).enter().append("td").text(function(e){return e}),e.shift(),this.bodyrows=this.body.selectAll("tr").data(this.graphdef.categories).enter().append("tr"),this.bodyrows.selectAll("td").data(function(e){var n=[],r,i;n.push(e);for(r=0,i=t[e].length;r<i;r+=1)n.push(t[e][r].value);return n}).enter().append("td").attr("class",function(e,t){return t===0?"chart3rtablelabel":"chart3rtabledata"}).text(function(e){return e})};